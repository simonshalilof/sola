<script>
    setAccount("your-public-ifields-key", "YourSoftwareName", "0.1.0");

    const paymentForm = document.getElementById('payment-form');
    const submitBtn = document.getElementById('submit-btn');

    paymentForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        submitBtn.disabled = true;

        try {
            await new Promise((resolve, reject) => {
                getTokens(resolve, reject);
            });

            const cardToken = document.querySelector('[data-ifields-id="card-number-token"]').value;
            const cvvToken = document.querySelector('[data-ifields-id="cvv-token"]').value;

            const payload = {
                xCardNum: cardToken,
                xCVV: cvvToken,
                xAmount: "10.00",               // example amount
                xExp: "1226",                   // example expiry date
                xKey: "your-private-key",       // NOT recommended on frontend
                xCommand: "cc:sale",
                xName: "John Doe"
            };

            const response = await fetch('https://example.com/payment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`Server responded with ${response.status}`);
            }

            const data = await response.json();
            console.log("Payment Response:", data);
            alert(`Payment Result: ${data.xResult}`);
        } catch (error) {
            console.error("Payment error:", error);
            alert(`Error: ${error.message}`);
        } finally {
            submitBtn.disabled = false;
        }
    });
</script>
